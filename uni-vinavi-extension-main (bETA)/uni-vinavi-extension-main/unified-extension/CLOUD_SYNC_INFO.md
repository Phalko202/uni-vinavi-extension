# Cloud Sync - Firebase Storage Information

## Where Your Data is Stored

### Firebase Database Path
All doctor data is stored in Firebase Realtime Database at:
```
/doctors/{uid}/vinavi-sync.json
```

- `{uid}` = unique doctor ID (auto-generated by Firebase when account is created)
- Each doctor sees ONLY their own data (enforced by database rules)

### Example:
If Dr. Ahmed signs in with email `ahmed@example.com`, Firebase assigns a UID like `AbC123xyz456`, and their data is stored at:
```
/doctors/AbC123xyz456/vinavi-sync.json
```

---

## What Data is Synced

### Lab Dashboard Data (localStorage)
- **Lab Bundles** → `labBundlesHMH`
- **Patient Bundles** → `labPatientBundlesHMH`
- **Clinical Sets** → `HMH_CLINICAL_SETS_V1`

### QuickText Data (chrome.storage.local)
- **Custom Templates** → `customTemplates`

**All data syncs automatically** whenever you:
- Create/edit/delete a lab bundle
- Create/edit/delete a patient bundle
- Create/edit/delete a QuickText template
- Manually click "Sync Now"

---

## How to View Data in Firebase Console

1. Go to Firebase Console → **Realtime Database**
2. View the tree structure:
   ```
   /doctors
     ├─ AbC123xyz456
     │    └─ vinavi-sync.json
     │         ├─ labBundlesHMH: "..."
     │         ├─ customTemplates: "..."
     │         └─ updatedAt: 1708123456789
     └─ XyZ789def012
          └─ vinavi-sync.json
               └─ ...
   ```

---

## Firebase Security Rules (Already Set)

```json
{
  "rules": {
    "doctors": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}
```

**Translation:**
- Each doctor can **only read and write their own data**
- Must be signed in to access any data
- No doctor can see another doctor's bundles or templates

---

## User Account Management

### Create Accounts (2 ways):

**Option 1: In the Extension (Recommended)**
1. Click **Cloud Account** button in dashboard
2. Click **Create Account**
3. Enter email + password (min 6 characters)
4. Done! Account is created and signed in automatically

**Option 2: Firebase Console**
1. Go to Firebase Console → **Authentication → Users**
2. Click **Add user**
3. Enter email + password
4. User can now sign in from the extension

---

## Troubleshooting

### "Push failed" or "Pull failed"
- Check Firebase API Key and Project ID in `cloud-config.js`
- Verify Email/Password auth is enabled in Firebase Console
- Check database rules are set correctly

### Data not syncing between computers
- Make sure you're signed in with the same email on both devices
- Click "Sync Now" to force a manual sync
- Check "Logs" view in the dashboard for sync events

### Account creation fails
- Password must be at least 6 characters
- Email must be valid format
- Check Firebase project has Email/Password enabled

---

## Data Size Limits

- **Firebase Realtime Database Free Tier**: 1 GB total storage
- **Typical usage per doctor**: ~5-50 KB (bundles + templates)
- **Supports**: ~20,000-200,000 doctors on free tier

---

## One Sign-In, Two Extensions Synced

When you sign in via the **Lab Dashboard**, both systems sync automatically:

✅ **Lab Dashboard** → bundles, patient bundles, clinical sets  
✅ **QuickText** → custom templates

No need to sign in separately or manually import/export files anymore!
